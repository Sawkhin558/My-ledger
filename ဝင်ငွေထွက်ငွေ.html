
<!DOCTYPE html>

<html lang="my">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Smart Cloud Ledger Pro</title>

    <style>

        :root { --p: #0078d4; --s: #107c10; --d: #d83b01; --bg: #f3f2f1; }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; }

        

        #lock-screen { position: fixed; inset: 0; background: white; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        .pin-input { font-size: 32px; width: 160px; text-align: center; border: 2px solid #ddd; border-radius: 12px; padding: 12px; letter-spacing: 5px; margin: 25px; outline: none; }



        .app-bar { background: var(--p); color: white; padding: 15px; display: flex; justify-content: space-between; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); align-items: center; }

        .sync-indicator { font-size: 11px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 10px; }



        .container { max-width: 600px; margin: auto; padding: 15px; }

        .dashboard { background: #201f1e; color: white; padding: 25px; border-radius: 20px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }

        .stat-box { padding: 15px; border-radius: 12px; color: white; text-align: center; font-weight: bold; }



        .tabs { display: flex; background: #e1dfdd; padding: 4px; border-radius: 12px; margin-bottom: 20px; }

        .tab { flex: 1; border: none; padding: 12px; border-radius: 10px; background: transparent; cursor: pointer; font-size: 13px; font-weight: bold; }

        .tab.active { background: white; color: var(--p); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }



        .item-card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 6px solid #ccc; transition: 0.3s; }

        .income { border-left-color: var(--s); }

        .expense { border-left-color: var(--d); }



        .fab { position: fixed; bottom: 30px; right: 25px; width: 65px; height: 65px; background: var(--p); color: white; border-radius: 50%; border: none; font-size: 35px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); cursor: pointer; }

        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; padding:20px; z-index:1000; }

        .modal-content { background:white; padding:25px; border-radius:25px; width:100%; max-width:400px; }

        input, select { width:100%; padding:14px; margin:10px 0; border:1px solid #ddd; border-radius:12px; font-size: 16px; box-sizing: border-box; }

    </style>

</head>

<body>



<div id="lock-screen">

    <div style="font-size: 60px;">ğŸ”</div>

    <h3 style="color:#333;">Passcode á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«</h3>

    <input type="password" id="pass-input" class="pin-input" maxlength="4" inputmode="numeric">

    <button onclick="checkPass()" style="padding:12px 50px; border-radius:30px; border:none; background:var(--p); color:white; font-weight:bold; cursor:pointer;">á€á€„á€ºá€™á€Šá€º</button>

</div>



<div class="app-bar">

    <div style="font-weight:bold;">Smart Ledger Pro</div>

    <div id="status" class="sync-indicator">Checking Sync...</div>

</div>



<div class="container">

    <div class="tabs">

        <button class="tab" onclick="setFilter('week', this)">á€•á€á€ºá€…á€‰á€º</button>

        <button class="tab active" onclick="setFilter('month', this)">á€œá€…á€‰á€º</button>

        <button class="tab" onclick="setFilter('year', this)">á€”á€¾á€…á€ºá€…á€‰á€º</button>

        <button class="tab" onclick="setFilter('all', this)">á€¡á€¬á€¸á€œá€¯á€¶á€¸</button>

    </div>



    <div class="dashboard">

        <small id="period-label">á€šá€á€¯á€œ á€œá€€á€ºá€€á€»á€”á€ºá€„á€½á€±</small>

        <h1 id="total-bal" style="font-size: 42px; margin: 10px 0;">0</h1>

        <div id="storage-txt" style="font-size: 11px; opacity: 0.7;">Cloud Capacity: 0%</div>

    </div>



    <div class="stats">

        <div class="stat-box" style="background:var(--s); shadow: 0 4px 10px rgba(16,124,16,0.3);">á€á€„á€ºá€„á€½á€±<br><span id="total-inc">0</span></div>

        <div class="stat-box" style="background:var(--d); shadow: 0 4px 10px rgba(216,59,1,0.3);">á€‘á€½á€€á€ºá€„á€½á€±<br><span id="total-exp">0</span></div>

    </div>



    <div id="analysis-box" style="background:white; padding:15px; border-radius:15px; margin-bottom:20px; text-align:center; border:1px solid #eee;">

        <small style="color:#666;">á€á€¯á€¶á€¸á€á€•á€ºá€á€»á€€á€º</small>

        <div id="analysis-text" style="font-weight:bold; margin-top:5px;">á€á€½á€€á€ºá€á€»á€€á€ºá€”á€±á€á€Šá€º...</div>

    </div>



    <div id="list-container"></div>

</div>



<button class="fab" onclick="showModal()">+</button>



<div id="entry-modal" class="modal">

    <div class="modal-content">

        <h3 id="modal-title">á€…á€¬á€›á€„á€ºá€¸á€¡á€á€…á€º</h3>

        <input type="hidden" id="edit-id">

        <input type="date" id="f-date">

        <input type="text" id="f-desc" placeholder="á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€¡á€›á€¬">

        <select id="f-type">

            <option value="income">á€á€„á€ºá€„á€½á€± (+)</option>

            <option value="expense">á€‘á€½á€€á€ºá€„á€½á€± (-)</option>

        </select>

        <input type="number" id="f-amt" placeholder="á€•á€™á€¬á€">

        <div style="display:flex; gap:10px; margin-top:20px;">

            <button onclick="saveEntry()" style="flex:2; padding:15px; background:var(--s); color:white; border:none; border-radius:12px; font-weight:bold;">á€á€­á€™á€ºá€¸á€™á€Šá€º</button>

            <button onclick="hideModal()" style="flex:1; padding:15px; background:#666; color:white; border:none; border-radius:12px;">á€•á€­á€á€ºá€™á€Šá€º</button>

        </div>

    </div>

</div>



<script>

    // âš ï¸ á€á€„á€·á€º Google Script URL á€€á€­á€¯ á€’á€®á€™á€¾á€¬ á€‘á€Šá€·á€ºá€•á€«

    const API_URL = "https://script.google.com/macros/s/AKfycbz63eK5R83SkNaCphaychSzH970oCMOsSa0Xo7UCw1N0HyON3R0D6esqMsTL5taMWY/exec";

    let database = JSON.parse(localStorage.getItem('my_cloud_ledger')) || [];

    let currentFilter = 'month';



    function checkPass() {

        if (document.getElementById('pass-input').value === "1996") {

            document.getElementById('lock-screen').style.display = 'none';

            // á€¡á€„á€ºá€á€¬á€”á€€á€ºá€›á€¾á€­á€›á€„á€º Cloud á€€ data á€¡á€›á€„á€ºá€†á€½á€²á€™á€šá€º (Overwrite á€™á€–á€¼á€…á€ºá€¡á€±á€¬á€„á€º)

            if(navigator.onLine) fetchCloudData(); else render();

        } else {

            alert("Passcode á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€•á€«á€á€Šá€ºá‹");

            document.getElementById('pass-input').value = "";

        }

    }



    // Cloud á€†á€®á€€ á€’á€±á€á€¬á€€á€­á€¯ á€†á€½á€²á€šá€°á€á€¼á€„á€ºá€¸ (Download)

    async function fetchCloudData() {

        document.getElementById('status').innerText = "Syncing...â³";

        try {

            const response = await fetch(API_URL);

            const cloudData = await response.json();

            if (Array.isArray(cloudData)) {

                // Cloud á€€ data á€€á€­á€¯ á€¡á€›á€„á€ºá€šá€°á€•á€¼á€®á€¸á€™á€¾ Local á€”á€²á€· á€•á€±á€«á€„á€ºá€¸á€…á€•á€ºá€™á€šá€º

                database = cloudData;

                saveLocal();

                render();

                document.getElementById('status').innerText = "Cloud Synced âœ…";

            }

        } catch (e) {

            document.getElementById('status').innerText = "Offline Mode ğŸ“";

            render();

        }

    }



    // Cloud á€•á€±á€«á€ºá€á€­á€¯á€· á€’á€±á€á€¬á€á€„á€ºá€á€¼á€„á€ºá€¸ (Upload)

    async function uploadToCloud() {

        if(!navigator.onLine) return;

        document.getElementById('status').innerText = "Uploading...â³";

        try {

            await fetch(API_URL, { 

                method: 'POST', 

                mode: 'no-cors', 

                body: JSON.stringify(database) 

            });

            document.getElementById('status').innerText = "Cloud Synced âœ…";

        } catch (e) {

            document.getElementById('status').innerText = "Upload Failed âŒ";

        }

    }



    function render() {

        const container = document.getElementById('list-container');

        container.innerHTML = "";

        let inc = 0, exp = 0;

        const now = new Date();



        let filtered = database.filter(item => {

            const d = new Date(item.date);

            if (currentFilter === 'week') {

                const start = new Date(); start.setDate(now.getDate() - 7);

                return d >= start && d <= now;

            }

            if (currentFilter === 'month') return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();

            if (currentFilter === 'year') return d.getFullYear() === now.getFullYear();

            return true;

        });



        filtered.sort((a,b) => new Date(b.date) - new Date(a.date));



        filtered.forEach(item => {

            const amt = parseFloat(item.amount);

            if(item.type === 'income') inc += amt; else exp += amt;

            container.innerHTML += `

                <div class="item-card ${item.type}">

                    <div>

                        <small style="color:#888">${item.date.split('-').reverse().join('/')}</small>

                        <div style="font-weight:bold; color:#333; margin-top:2px;">${item.desc}</div>

                    </div>

                    <div style="text-align:right">

                        <b style="color:${item.type==='income'?'var(--s)':'var(--d)'}">${item.type==='income'?'+':'-'}${amt.toLocaleString()}</b>

                        <div style="margin-top:8px; font-size:18px;">

                            <span onclick="editItem('${item.id}')" style="margin-right:15px; cursor:pointer;">âœï¸</span>

                            <span onclick="deleteItem('${item.id}')" style="cursor:pointer;">ğŸ—‘ï¸</span>

                        </div>

                    </div>

                </div>`;

        });



        const bal = inc - exp;

        document.getElementById('total-bal').innerText = bal.toLocaleString();

        document.getElementById('total-inc').innerText = inc.toLocaleString();

        document.getElementById('total-exp').innerText = exp.toLocaleString();



        const analysis = document.getElementById('analysis-text');

        if(bal > 0) analysis.innerHTML = `<span style="color:var(--s)">á€„á€½á€± ${bal.toLocaleString()} á€…á€¯á€™á€­á€•á€«á€á€Šá€ºá‹ ğŸ’°</span>`;

        else if(bal < 0) analysis.innerHTML = `<span style="color:var(--d)">á€„á€½á€± ${Math.abs(bal).toLocaleString()} á€•á€­á€¯á€á€¯á€¶á€¸á€™á€­á€•á€«á€á€Šá€ºá‹ âš ï¸</span>`;

        else analysis.innerHTML = "á€á€„á€ºá€„á€½á€±á€”á€¾á€„á€·á€º á€‘á€½á€€á€ºá€„á€½á€± á€™á€»á€¾á€á€•á€«á€á€Šá€ºá‹";



        const usage = (database.length / 100000 * 100).toFixed(2);

        document.getElementById('storage-txt').innerText = `Cloud Capacity: ${usage}% (of 100,000)`;

    }



    function setFilter(mode, btn) {

        currentFilter = mode;

        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

        btn.classList.add('active');

        document.getElementById('period-label').innerText = mode === 'all' ? "á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ á€œá€€á€ºá€€á€»á€”á€ºá€„á€½á€±" : `${mode === 'week' ? 'á€•á€á€ºá€…á€‰á€º' : mode === 'month' ? 'á€œá€…á€‰á€º' : 'á€”á€¾á€…á€ºá€…á€‰á€º'} á€œá€€á€ºá€€á€»á€”á€ºá€„á€½á€±`;

        render();

    }



    function saveEntry() {

        const id = document.getElementById('edit-id').value || "ID-" + Date.now();

        const entry = {

            id: id,

            date: document.getElementById('f-date').value,

            desc: document.getElementById('f-desc').value,

            type: document.getElementById('f-type').value,

            amount: document.getElementById('f-amt').value

        };

        if(!entry.desc || !entry.amount) return alert("á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€…á€½á€¬ á€–á€¼á€Šá€·á€ºá€•á€«");



        const idx = database.findIndex(x => x.id === id);

        if(idx > -1) database[idx] = entry; else database.push(entry);



        saveLocal();

        render();

        hideModal();

        uploadToCloud();

    }



    function editItem(id) {

        const item = database.find(x => x.id === id);

        document.getElementById('edit-id').value = item.id;

        document.getElementById('f-date').value = item.date;

        document.getElementById('f-desc').value = item.desc;

        document.getElementById('f-type').value = item.type;

        document.getElementById('f-amt').value = item.amount;

        document.getElementById('modal-title').innerText = "á€…á€¬á€›á€„á€ºá€¸á€•á€¼á€„á€ºá€†á€„á€ºá€›á€”á€º";

        document.getElementById('entry-modal').style.display = 'flex';

    }



    function deleteItem(id) {

        if(confirm("á€¤á€…á€¬á€›á€„á€ºá€¸á€€á€­á€¯ á€–á€»á€€á€ºá€›á€”á€º á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {

            database = database.filter(x => x.id !== id);

            saveLocal();

            render();

            uploadToCloud();

        }

    }



    function saveLocal() { localStorage.setItem('my_cloud_ledger', JSON.stringify(database)); }

    function showModal() { document.getElementById('entry-modal').style.display = 'flex'; document.getElementById('f-date').value = new Date().toISOString().split('T')[0]; }

    function hideModal() { document.getElementById('entry-modal').style.display = 'none'; document.getElementById('edit-id').value = ""; document.getElementById('f-desc').value = ""; document.getElementById('f-amt').value = ""; document.getElementById('modal-title').innerText = "á€…á€¬á€›á€„á€ºá€¸á€¡á€á€…á€º"; }



    window.addEventListener('online', fetchCloudData);

</script>



</body>

</html>
